<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Nuseum Of Tanta Mien - Admin Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  </head>

  <body data-bs-spy="scroll" data-bs-target=".navbar" data-bs-offset="100" tabindex="0">
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg fixed-top py-2">
      <div class="container">
        <a class="navbar-brand" href="index.html">
          <img src="images/logo.svg" alt="Logo" width="100" height="auto" />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="index.html#about">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="menu.html">Menu</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Reservation</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- ADMIN PRODUCT MANAGEMENT SECTION -->
    <section class="container pt-5 mt-5">
      <h1 class="text-center mb-5 position-relative">
        <b>Product Management</b>
        <span class="title-underline"></span>
      </h1>
      <div class="row justify-content-center">
        <div class="col-12">
          <div class="card" style="background-color: var(--secondary-color); border-radius: 15px;">
            <div class="card-body">
              <h4 class="text-center mb-4" style="font-family: 'Inter Bold', sans-serif;">Manage Menu Products</h4>
              <!-- Add Product Button -->
              <div class="text-center mb-4">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal" style="background-color: var(--text-color); border-radius: 90px; padding: 10px 20px;">
                  Add New Product
                </button>
              </div>
              <div class="table-responsive">
                <table class="table table-bordered orders-table">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Title</th>
                      <th>Description</th>
                      <th>Category</th>
                      <th>Price</th>
                      <th>Image</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="productsTableBody">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ADD PRODUCT MODAL -->
    <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content" style="background-color: var(--secondary-color); border-radius: 15px;">
          <div class="modal-header" style="background-color: var(--text-color); color: #fff;">
            <h5 class="modal-title" id="addProductModalLabel" style="font-family: 'Inter Bold', sans-serif;">Add New Product</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" style="background-color: var(--primary-color);">
            <form id="addProductForm">
              <div class="mb-3">
                <label for="productTitle" class="form-label" style="font-family: 'Inter', sans-serif; color: var(--text-color);">Title</label>
                <input type="text" class="form-control" id="productTitle" required style="border-radius: 10px; border: 1px solid var(--text-color); background-color: var(--secondary-color);" />
              </div>
              <div class="mb-3">
                <label for="productDescription" class="form-label" style="font-family: 'Inter', sans-serif; color: var(--text-color);">Description</label>
                <textarea class="form-control" id="productDescription" required style="border-radius: 10px; border: 1px solid var(--text-color); background-color: var(--secondary-color);"></textarea>
              </div>
              <div class="mb-3">
                <label for="productCategory" class="form-label" style="font-family: 'Inter', sans-serif; color: var(--text-color);">Category</label>
                <select class="form-control" id="productCategory" required style="border-radius: 10px; border: 1px solid var(--text-color); background-color: var(--secondary-color);">
                  <option value="makanan">Food</option>
                  <option value="minuman">Drink</option>
                  <option value="dessert">Dessert</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="productPrice" class="form-label" style="font-family: 'Inter', sans-serif; color: var(--text-color);">Price (Rp)</label>
                <input type="number" class="form-control" id="productPrice" required min="0" style="border-radius: 10px; border: 1px solid var(--text-color); background-color: var(--secondary-color);" />
              </div>
              <div class="mb-3">
                <label for="productImage" class="form-label" style="font-family: 'Inter', sans-serif; color: var(--text-color);">Upload Image (Optional)</label>
                <input type="file" class="form-control" id="productImage" accept="image/*" style="border-radius: 10px; border: 1px solid var(--text-color); background-color: var(--secondary-color);" />
                <img id="addImagePreview" src="" alt="Image Preview" style="display: none; max-width: 100%; margin-top: 10px; border-radius: 10px;" />
              </div>
              <div class="d-grid">
                <button type="submit" class="btn btn-primary" style="background-color: var(--text-color); border-radius: 90px; padding: 10px 20px;">Add Product</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- EDIT PRODUCT MODAL -->
    <div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content" style="background-color: var(--secondary-color); border-radius: 15px;">
          <div class="modal-header" style="background-color: var(--text-color); color: #fff;">
            <h5 class="modal-title" id="editProductModalLabel" style="font-family: 'Inter Bold', sans-serif;">Edit Product</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" style="background-color: var(--primary-color);">
            <form id="editProductForm">
              <input type="hidden" id="editProductId" />
              <div class="mb-3">
                <label for="editProductTitle" class="form-label" style="font-family: 'Inter', sans-serif; color: var(--text-color);">Title</label>
                <input type="text" class="form-control" id="editProductTitle" required style="border-radius: 10px; border: 1px solid var(--text-color); background-color: var(--secondary-color);" />
              </div>
              <div class="mb-3">
                <label for="editProductDescription" class="form-label" style="font-family: 'Inter', sans-serif; color: var(--text-color);">Description</label>
                <textarea class="form-control" id="editProductDescription" required style="border-radius: 10px; border: 1px solid var(--text-color); background-color: var(--secondary-color);"></textarea>
              </div>
              <div class="mb-3">
                <label for="editProductCategory" class="form-label" style="font-family: 'Inter', sans-serif; color: var(--text-color);">Category</label>
                <select class="form-control" id="editProductCategory" required style="border-radius: 10px; border: 1px solid var(--text-color); background-color: var(--secondary-color);">
                  <option value="makanan">Food</option>
                  <option value="minuman">Drink</option>
                  <option value="dessert">Dessert</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="editProductPrice" class="form-label" style="font-family: 'Inter', sans-serif; color: var(--text-color);">Price (Rp)</label>
                <input type="number" class="form-control" id="editProductPrice" required min="0" style="border-radius: 10px; border: 1px solid var(--text-color); background-color: var(--secondary-color);" />
              </div>
              <div class="mb-3">
                <label for="editProductImage" class="form-label" style="font-family: 'Inter', sans-serif; color: var(--text-color);">Upload Image (Optional)</label>
                <input type="file" class="form-control" id="editProductImage" accept="image/*" style="border-radius: 10px; border: 1px solid var(--text-color); background-color: var(--secondary-color);" />
                <img id="editImagePreview" src="" alt="Image Preview" style="max-width: 100%; margin-top: 10px; border-radius: 10px;" />
              </div>
              <div class="d-grid">
                <button type="submit" class="btn btn-primary" style="background-color: var(--text-color); border-radius: 90px; padding: 10px 20px;">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Check authentication
        const authToken = localStorage.getItem('adminAuthToken');
        if (!authToken || authToken !== 'authenticated') {
          window.location.href = 'login.html';
        }

        const productsTableBody = document.getElementById('productsTableBody');
        const addProductForm = document.getElementById('addProductForm');
        const editProductForm = document.getElementById('editProductForm');
        const addImageInput = document.getElementById('productImage');
        const addImagePreview = document.getElementById('addImagePreview');
        const editImageInput = document.getElementById('editProductImage');
        const editImagePreview = document.getElementById('editImagePreview');

        let products = JSON.parse(localStorage.getItem('products')) || [];

        function saveProducts() {
          localStorage.setItem('products', JSON.stringify(products));
          // Dispatch custom event to notify other pages
          window.dispatchEvent(new Event('productsUpdated'));
        }

        // Image upload handler
        function handleImageUpload(file, callback) {
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              callback(e.target.result);
            };
            reader.readAsDataURL(file);
          } else {
            callback('images/placeholder.jpg');
          }
        }

        // Preview image for add product
        addImageInput.addEventListener('change', (event) => {
          const file = event.target.files[0];
          if (file) {
            handleImageUpload(file, (base64Image) => {
              addImagePreview.src = base64Image;
              addImagePreview.style.display = 'block';
            });
          } else {
            addImagePreview.src = 'images/placeholder.jpg';
            addImagePreview.style.display = 'block';
          }
        });

        // Preview image for edit product
        editImageInput.addEventListener('change', (event) => {
          const file = event.target.files[0];
          if (file) {
            handleImageUpload(file, (base64Image) => {
              editImagePreview.src = base64Image;
            });
          }
        });

        function renderProducts() {
          productsTableBody.innerHTML = '';
          if (products.length === 0) {
            productsTableBody.innerHTML = '<tr><td colspan="7" class="text-center">No products found.</td></tr>';
            return;
          }

          products.forEach(product => {
            const rowHTML = `
              <tr>
                <td style="font-family: 'Inter', sans-serif;">${product.id}</td>
                <td style="font-family: 'Inter', sans-serif;">${product.title}</td>
                <td style="font-family: 'Inter', sans-serif;">${product.description}</td>
                <td style="font-family: 'Inter', sans-serif;">${product.category.charAt(0).toUpperCase() + product.category.slice(1)}</td>
                <td style="font-family: 'Inter', sans-serif;">Rp ${product.price.toLocaleString('id-ID')}</td>
                <td style="font-family: 'Inter', sans-serif;"><img src="${product.image || 'images/placeholder.jpg'}" alt="${product.title}" style="width: 50px; height: auto; border-radius: 5px;" /></td>
                <td>
                  <button class="btn btn-sm btn-primary edit-product" data-id="${product.id}" data-bs-toggle="modal" data-bs-target="#editProductModal" style="background-color: var(--text-color); border-radius: 90px; margin-right: 5px;">Edit</button>
                  <button class="btn btn-sm btn-danger delete-product" data-id="${product.id}" style="border-radius: 90px;">Delete</button>
                </td>
              </tr>
            `;
            productsTableBody.insertAdjacentHTML('beforeend', rowHTML);
          });

          // Attach event listeners for edit and delete buttons
          document.querySelectorAll('.edit-product').forEach(button => {
            button.addEventListener('click', () => {
              const productId = button.getAttribute('data-id');
              const product = products.find(p => p.id === productId);
              document.getElementById('editProductId').value = product.id;
              document.getElementById('editProductTitle').value = product.title;
              document.getElementById('editProductDescription').value = product.description;
              document.getElementById('editProductCategory').value = product.category;
              document.getElementById('editProductPrice').value = product.price;
              editImagePreview.src = product.image || 'images/placeholder.jpg';
              editImagePreview.style.display = 'block';
            });
          });

          document.querySelectorAll('.delete-product').forEach(button => {
            button.addEventListener('click', () => {
              const productId = button.getAttribute('data-id');
              if (confirm('Are you sure you want to delete this product?')) {
                products = products.filter(p => p.id !== productId);
                saveProducts();
                renderProducts();
              }
            });
          });
        }

        // Add Product Form Submission
        addProductForm.addEventListener('submit', (event) => {
          event.preventDefault();
          const file = addImageInput.files[0];
          handleImageUpload(file, (image) => {
            const newProduct = {
              id: Date.now().toString(),
              title: document.getElementById('productTitle').value,
              description: document.getElementById('productDescription').value,
              category: document.getElementById('productCategory').value,
              price: parseInt(document.getElementById('productPrice').value),
              image: image
            };
            products.push(newProduct);
            saveProducts();
            renderProducts();
            bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
            addProductForm.reset();
            addImagePreview.src = '';
            addImagePreview.style.display = 'none';
          });
        });

        // Edit Product Form Submission
        editProductForm.addEventListener('submit', (event) => {
          event.preventDefault();
          const productId = document.getElementById('editProductId').value;
          const file = editImageInput.files[0];
          const updateProduct = (image) => {
            products = products.map(product =>
              product.id === productId ? {
                ...product,
                title: document.getElementById('editProductTitle').value,
                description: document.getElementById('editProductDescription').value,
                category: document.getElementById('editProductCategory').value,
                price: parseInt(document.getElementById('editProductPrice').value),
                image: image
              } : product
            );
            saveProducts();
            renderProducts();
            bootstrap.Modal.getInstance(document.getElementById('editProductModal')).hide();
            editImageInput.value = '';
          };

          if (file) {
            handleImageUpload(file, updateProduct);
          } else {
            updateProduct(editImagePreview.src || 'images/placeholder.jpg');
          }
        });

        // Initial render
        renderProducts();
      });
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
      crossorigin="anonymous"
    ></script>
  </body>
</html>